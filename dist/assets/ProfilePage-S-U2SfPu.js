import{r,a as N,j as e,u as _,b as y,N as b}from"./index-BAH94AsE.js";import{c as E}from"./auth-CkWy4Jij.js";import{L as S,T as k,S as P,B as L}from"./BottomNavbar-CoKUF_2U.js";import{P as x}from"./Post-SE6ZSh97.js";import"./logo-lBSZb2lU.js";import"./TileLayer-Ct-sMkY9.js";const $=()=>{const[o,i]=r.useState([]),[t,h]=r.useState(!0),[f,u]=r.useState(null),[c,m]=r.useState(0),[a,p]=r.useState(!0),{userId:n}=N(),l=r.useRef(null),v=async s=>{h(!0),u(null);try{const d=n?`http://localhost/youthsthought/backend/get_posts.php?user_id=${n}&offset=${s}`:`http://localhost/youthsthought/backend/get_posts.php?offset=${s}`,w=await fetch(d,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!w.ok)throw new Error("Failed to fetch posts.");const g=await w.json();if(Array.isArray(g))g.length===0?p(!1):(i(j=>[...j,...g]),m(j=>j+5));else throw new Error("Invalid data format received from server.")}catch(d){console.error("Error fetching posts:",d),u("Failed to fetch posts.")}finally{h(!1)}};return r.useEffect(()=>{v(c)},[n]),r.useEffect(()=>{const s=new IntersectionObserver(d=>{d[0].isIntersecting&&!t&&a&&v(c)},{threshold:1});return l.current&&s.observe(l.current),()=>{l.current&&s.unobserve(l.current)}},[t,a,c]),e.jsxs(e.Fragment,{children:[f&&e.jsx("div",{children:f}),t&&o.length===0&&e.jsx("div",{children:"Loading..."}),o.length===0&&!t&&e.jsx("div",{children:"No posts available."}),e.jsx("div",{className:"newsfeed left",children:o.filter(s=>s.serial_id%2!==0).map(s=>e.jsx(x,{post:s},s.post_id))}),e.jsx("div",{className:"newsfeed right",children:o.filter(s=>s.serial_id%2===0).map(s=>e.jsx(x,{post:s},s.post_id))}),e.jsx("div",{className:"newsfeed mobile",children:o.map(s=>e.jsx(x,{post:s},s.post_id))}),e.jsx("div",{ref:l,className:"loader",children:t})]})},I=()=>{window.location.href="https://www.youthsthought.com/backend/logout.php"},B=()=>{const o=_();y();const{userId:i}=N(),[t,h]=r.useState(null),[f,u]=r.useState(!0);if(r.useEffect(()=>{(async()=>{try{(await E()).status!=="success"&&o("/login")}catch(a){console.error("Session verification failed:",a),o("/login")}})()},[o]),r.useEffect(()=>{(async()=>{try{const a=i?`https://www.youthsthought.com/backend/get_profile_data.php?user_id=${i}`:"https://www.youthsthought.com/backend/get_profile_data.php",p=await fetch(a,{credentials:"include"});if(!p.ok)throw new Error("Network response was not ok");const n=await p.json();console.log(n),h(n)}catch(a){console.error("Error fetching user data",a)}finally{u(!1)}})()},[i]),f)return e.jsx(S,{});if(!t)return e.jsx("div",{children:"Error loading user data."});const c=!i;return e.jsxs("div",{className:"profile-page",children:[e.jsx(k,{}),e.jsxs("div",{className:"main-container",children:[e.jsx(P,{}),e.jsxs("div",{className:"content",children:[e.jsxs("div",{className:"profile-header",children:[e.jsx("div",{className:"profile-header__avatar",children:e.jsx("img",{src:t.profile_pic?`../../public/dp/${t.profile_pic}`:"../../public/dp/default.png",alt:t.name})}),e.jsxs("div",{className:"profile-header__details",children:[e.jsx("h1",{className:"username",children:t.name}),e.jsx("p",{className:"designation",children:t.designation}),e.jsx("p",{className:"bio",children:t.bio}),c?e.jsxs(e.Fragment,{children:[e.jsx(b,{to:"/edit-profile",children:e.jsx("button",{className:"edit-profile-btn",children:"Edit Profile"})}),e.jsx("button",{className:"logout-btn",onClick:I,children:"Logout"})]}):e.jsx(b,{to:`/inbox/${t.id}`,className:"message-profile-btn",children:"Message"})]})]}),e.jsx("div",{className:"newsfeed-container",children:e.jsx($,{})})]})]}),e.jsx(L,{})]})};export{B as default};
