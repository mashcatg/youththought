import{r,j as e,N as k}from"./index-BAH94AsE.js";import{M as y,T as N,a as v,P as _,B as C,L as R,b as $,c as S,d as I}from"./TileLayer-Ct-sMkY9.js";import{F as E,a as L,b as T,c as U}from"./BottomNavbar-CoKUF_2U.js";const M=({post:t})=>{const[p,m]=r.useState(!1),[n,d]=r.useState(!1),l=t.post_id,[u,f]=r.useState(0),h=r.useRef(null);r.useEffect(()=>{(async()=>{try{const a=await(await fetch(`http://localhost/youthsthought/backend/get_reaction.php?post_id=${l}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"})).json();a.liked&&d(!0),f(a.total_reacts)}catch(s){console.error("Error fetching liked state:",s)}})()},[l]);const x=(o,s)=>o.length>s?o.substring(0,s)+"... ":o,j=o=>{const s=/(?:youtube\.com\/(?:[^/]+\/[^/]+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?/ ]{11})/,a=o.match(s);return a?a[1]:null},w=o=>{const s=/(?:drive\.google\.com\/file\/d\/|open\?id=)([\w-]{25,})/,a=o.match(s);return a?a[1]:null},b=async()=>{const o=n;try{await fetch(n?"http://localhost/youthsthought/backend/remove_reaction.php":"http://localhost/youthsthought/backend/add_reaction.php",{method:n?"DELETE":"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({post_id:l})}),d(!n)}catch(s){console.error("Error updating reaction:",s),d(o)}},i=o=>{const s="http://localhost:5173/post/"+t.post_id,a=t.post_description;let c="";switch(o){case"facebook":c=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(s)}`;break;case"twitter":c=`https://twitter.com/intent/tweet?url=${encodeURIComponent(s)}&text=${encodeURIComponent(a)}`;break;case"linkedin":c=`https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(s)}&title=${encodeURIComponent(t.title)}&summary=${encodeURIComponent(a)}`;break;case"email":c=`mailto:?subject=${encodeURIComponent(t.title)}&body=${encodeURIComponent(a)}%0A%0A${encodeURIComponent(s)}`;break;case"whatsapp":c=`https://api.whatsapp.com/send?text=${encodeURIComponent(a)}%20${encodeURIComponent(s)}`;break;case"copy":navigator.clipboard.writeText(s),alert("Link copied to clipboard!");return;default:return}window.open(c,"_blank","noopener,noreferrer")},g=()=>{m(!p)};return r.useEffect(()=>{const o=s=>{h.current&&!h.current.contains(s.target)&&m(!1)};return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[]),e.jsxs("div",{className:"post",children:[e.jsxs("div",{className:"post-header",children:[e.jsx("img",{src:`../../public/dp/${t.profile_picture}`,alt:"Profile",className:"profile-pic"}),e.jsxs("div",{className:"post-info",children:[e.jsx("span",{className:"name",children:t.name}),e.jsx("span",{className:"date",children:new Date(t.created_at).toDateString()})]})]}),e.jsxs(k,{to:`/post/${l}`,className:"menu-item",children:[e.jsxs("div",{className:"post-description",children:[x(t.post_description,150),t.post_description.length>150&&e.jsx("a",{className:"view-more",href:"#",children:"View More"})]}),t.attachment_type==="image"&&e.jsx("img",{src:`../../public/posts/${t.file_link}`,alt:"Post media",className:"post-media"}),t.attachment_type==="video"&&e.jsx(e.Fragment,{children:t.file_link.includes("youtube.com")||t.file_link.includes("youtu.be")?e.jsx("iframe",{width:"560",height:"315",src:`https://www.youtube.com/embed/${j(t.file_link)}`,title:"YouTube video",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"post-media"}):t.file_link.includes("facebook.com")?e.jsx("iframe",{src:`https://www.facebook.com/plugins/video.php?href=${encodeURIComponent(t.file_link)}&show_text=0&width=560`,width:"560",height:"315",style:{border:"none",overflow:"hidden"},scrolling:"no",frameBorder:"0",allow:"autoplay; clipboard-write; encrypted-media; picture-in-picture",allowFullScreen:!0,className:"post-media"}):t.file_link.includes("drive.google.com")?e.jsx("iframe",{src:`https://drive.google.com/file/d/${w(t.file_link)}/preview`,width:"640",height:"480",allow:"autoplay",className:"post-media"}):e.jsx("video",{controls:!0,src:t.file_link,className:"post-media"})}),t.lat&&t.lng&&e.jsxs(y,{center:[t.lat,t.lng],zoom:13,className:"post-map",children:[e.jsx(N,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(v,{position:[t.lat,t.lng],children:e.jsxs(_,{children:[t.user_id,"'s Location"]})})]}),t.post_type==="Crowdfunding"&&e.jsxs("div",{className:"funding-info",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress",style:{width:`${t.fund_amount/t.currency*100}%`}})}),e.jsxs("span",{className:"funding-amount",children:[e.jsxs("span",{className:"bold-text",children:[t.fund_amount," ",t.currency]})," ","Raised"]})]})]}),e.jsxs("div",{className:"post-actions",children:[e.jsxs("div",{className:"left-actions",children:[e.jsxs("button",{className:"action-button",style:{color:n?"#4080ff":"inherit"},onClick:b,children:[e.jsx(C,{style:{marginRight:"8px"}})," ",e.jsx("span",{className:"total-reacts",children:n?u+1:u})]}),t.post_type==="crowdfunding"&&e.jsxs("button",{className:"action-button",children:[e.jsx(R,{style:{strokeWidth:"1"}})," "]})]}),e.jsxs("div",{className:"right-actions",children:[e.jsx("button",{className:"action-button",onClick:g,children:e.jsx($,{})}),p&&e.jsx("div",{ref:h,className:"share-popup-container",children:e.jsxs("div",{className:"share-options",children:[e.jsx("button",{className:"share-option",onClick:()=>i("facebook"),children:e.jsx(E,{})}),e.jsx("button",{className:"share-option",onClick:()=>i("twitter"),children:e.jsx(L,{})}),e.jsx("button",{className:"share-option",onClick:()=>i("linkedin"),children:e.jsx(T,{})}),e.jsx("button",{className:"share-option",onClick:()=>i("whatsapp"),children:e.jsx(U,{})}),e.jsx("button",{className:"share-option",onClick:()=>i("email"),children:e.jsx(S,{})}),e.jsx("button",{className:"share-option",onClick:()=>i("copy"),children:e.jsx(I,{})})]})})]})]})]})};export{M as P};
