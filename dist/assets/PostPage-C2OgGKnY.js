import{a as k,r as n,j as e}from"./index-BAH94AsE.js";import{M as y,T as N,a as v,P as _,B as C,L as S,b as R,c as I,d as $}from"./TileLayer-Ct-sMkY9.js";import{T as E,S as L,F as P,a as T,b as U,c as F,B}from"./BottomNavbar-CoKUF_2U.js";import"./logo-lBSZb2lU.js";const G=()=>{const{postId:l}=k(),[t,u]=n.useState(null),[D,f]=n.useState(!0),[m,h]=n.useState(!1);n.useState(0);const d=n.useRef(null),x=async()=>{try{const s=await(await fetch(`https://www.youthsthought.com/backend/get_post_data.php?post_id=${l}`,{method:"GET",credentials:"include"})).json();console.log("Fetched data:",s),u(s),p(s.has_liked)}catch(o){console.error("Error fetching post:",o)}finally{f(!1)}};n.useEffect(()=>{x()},[l]);const[i,p]=n.useState(!1),w=async()=>{const o=i;try{await fetch(i?"https://www.youthsthought.com/backend/remove_reaction.php":"https://www.youthsthought.com/backend/add_reaction.php",{method:i?"DELETE":"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({post_id:l})}),p(!i)}catch(s){console.error("Error updating reaction:",s),p(o)}},c=o=>{const s="http://localhost:5173/post/"+l,a=t.post_description;let r="";switch(o){case"facebook":r=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(s)}`;break;case"twitter":r=`https://twitter.com/intent/tweet?url=${encodeURIComponent(s)}&text=${encodeURIComponent(a)}`;break;case"linkedin":r=`https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(s)}&title=${encodeURIComponent(t.title)}&summary=${encodeURIComponent(a)}`;break;case"email":r=`mailto:?subject=${encodeURIComponent(t.title)}&body=${encodeURIComponent(a)}%0A%0A${encodeURIComponent(s)}`;break;case"whatsapp":r=`https://api.whatsapp.com/send?text=${encodeURIComponent(a)}%20${encodeURIComponent(s)}`;break;case"copy":navigator.clipboard.writeText(s),alert("Link copied to clipboard!");return;default:return}window.open(r,"_blank","noopener,noreferrer")},g=()=>{h(!m)};n.useEffect(()=>{const o=s=>{d.current&&!d.current.contains(s.target)&&h(!1)};return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[]);const j=o=>{const s=/(?:youtube\.com\/(?:[^/]+\/[^/]+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?/ ]{11})/,a=o.match(s);return a?a[1]:null},b=o=>{const s=/(?:drive\.google\.com\/file\/d\/|open\?id=)([\w-]{25,})/,a=o.match(s);return a?a[1]:null};return t?e.jsxs("div",{className:"post-page",children:[e.jsx(E,{}),e.jsxs("div",{className:"main-container",children:[e.jsx(L,{}),e.jsxs("div",{className:"post",children:[e.jsxs("div",{className:"post-header",children:[e.jsx("img",{src:"../../public/dp/"+t.profile_picture,alt:"Profile",className:"profile-pic"}),e.jsxs("div",{className:"post-info",children:[e.jsx("span",{className:"name",children:t.name}),e.jsx("span",{className:"date",children:new Date(t.created_at).toLocaleDateString()})]})]}),e.jsx("div",{className:"post-description",children:t.post_description}),t.attachment_type==="image"&&e.jsx("img",{src:"../../public/posts/"+t.file_link,alt:"Post media",className:"post-media"}),t.attachment_type==="video"&&e.jsx(e.Fragment,{children:t.file_link.includes("youtube.com")||t.file_link.includes("youtu.be")?e.jsx("iframe",{width:"560",height:"315",src:`https://www.youtube.com/embed/${j(t.file_link)}`,title:"YouTube video",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"post-media"}):t.file_link.includes("facebook.com")?e.jsx("iframe",{src:`https://www.facebook.com/plugins/video.php?href=${encodeURIComponent(t.file_link)}&show_text=0&width=560`,width:"560",height:"315",style:{border:"none",overflow:"hidden"},scrolling:"no",frameBorder:"0",allow:"autoplay; clipboard-write; encrypted-media; picture-in-picture",allowFullScreen:!0,className:"post-media"}):t.file_link.includes("drive.google.com")?e.jsx("iframe",{src:`https://drive.google.com/file/d/${b(t.file_link)}/preview`,width:"640",height:"480",allow:"autoplay",className:"post-media"}):e.jsx("video",{controls:!0,src:t.file_link,className:"post-media"})}),t.post_type==="issue"&&t.lat&&t.lng&&e.jsxs(y,{center:[t.lat,t.lng],zoom:13,className:"post-map",children:[e.jsx(N,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(v,{position:[t.lat,t.lng],children:e.jsxs(_,{children:[t.name,"'s Location"]})})]}),t.post_type==="crowdfunding"&&e.jsxs("div",{className:"funding-info",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress",style:{width:`${t.raised_fund/t.fund_amount*100}%`}})}),e.jsxs("span",{className:"funding-amount",children:[e.jsxs("span",{className:"bold-text",children:[t.raised_fund," ",t.currency]})," ","Raised out of ",t.fund_amount," ",t.currency]})]}),e.jsxs("div",{className:"post-actions",children:[e.jsxs("div",{className:"left-actions",children:[e.jsxs("button",{className:"action-button",style:{color:i?"#4080ff":"inherit"},onClick:w,children:[e.jsx(C,{style:{marginRight:"8px"}}),e.jsx("span",{className:"total-reacts",children:i?t.total_reacts+1:t.total_reacts})]}),t.post_type==="crowdfunding"&&e.jsxs("button",{className:"action-button",children:[e.jsx(S,{style:{strokeWidth:"1",marginRight:"8px"}})," "]})]}),e.jsx("button",{className:"action-button",onClick:g,children:e.jsx(R,{className:"right-action"})}),m&&e.jsx("div",{ref:d,className:"share-popup-container",children:e.jsxs("div",{className:"share-options",children:[e.jsx("button",{className:"share-option",onClick:()=>c("facebook"),children:e.jsx(P,{})}),e.jsx("button",{className:"share-option",onClick:()=>c("twitter"),children:e.jsx(T,{})}),e.jsx("button",{className:"share-option",onClick:()=>c("linkedin"),children:e.jsx(U,{})}),e.jsx("button",{className:"share-option",onClick:()=>c("whatsapp"),children:e.jsx(F,{})}),e.jsx("button",{className:"share-option",onClick:()=>c("email"),children:e.jsx(I,{})}),e.jsx("button",{className:"share-option",onClick:()=>c("copy"),children:e.jsx($,{})})]})})]})]})]}),e.jsx(B,{})]}):e.jsx("div",{children:"Post not found"})};export{G as default};
