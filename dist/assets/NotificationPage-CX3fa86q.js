import{r as n,j as e,N as v}from"./index-BAH94AsE.js";import{T as y,S as b,B as _}from"./BottomNavbar-CoKUF_2U.js";import"./logo-lBSZb2lU.js";const R=()=>{const[c,h]=n.useState([]),[g,x]=n.useState(1),[l,N]=n.useState(!0),d=n.useRef();n.useEffect(()=>{l&&(async()=>{try{const s=await fetch(`https://www.youthsthought.com/backend/get_notifications.php?page=${g}`,{credentials:"include"});if(!s.ok)throw new Error("Network response was not ok");const a=await s.json();h(r=>{const m=a.notifications.filter(o=>!r.some(i=>i.notification_id===o.notification_id));return[...r,...m]}),a.notifications.length<a.limit&&N(!1)}catch(s){console.error("Error fetching notifications:",s)}})()},[g,l]);const j=n.useCallback(t=>{d.current&&d.current.disconnect(),d.current=new IntersectionObserver(s=>{s[0].isIntersecting&&l&&x(a=>a+1)}),t&&d.current.observe(t)},[l]),w=async t=>{try{await fetch(`https://www.youthsthought.com/backend/mark_as_read.php?id=${t}`,{method:"POST",credentials:"include"}),h(s=>s.map(a=>a.notification_id===t?{...a,status:"Read"}:a))}catch(s){console.error("Error marking notification as read:",s)}},k=async()=>{try{await fetch("https://www.youthsthought.com/backend/mark_all_as_read.php",{method:"POST",credentials:"include"}),h(t=>t.map(s=>({...s,status:"Read"})))}catch(t){console.error("Error marking all notifications as read:",t)}},$=t=>{const s=new Date(t+"Z"),r=new Date-s,m=Math.floor(r/1e3),o=Math.floor(r/(1e3*60)),i=Math.floor(r/(1e3*60*60)),f=Math.floor(r/(1e3*60*60*24)),u=Math.floor(r/(1e3*60*60*24*30)),p=Math.floor(r/(1e3*60*60*24*365));return m<60?"Just now":o<60?`${o} minute${o>1?"s":""} ago`:i<24?`${i} hour${i>1?"s":""} ago`:f<30?`${f} day${f>1?"s":""} ago`:u<12?`${u} month${u>1?"s":""} ago`:`${p} year${p>1?"s":""} ago`};return e.jsxs("div",{className:"notification-page",children:[e.jsx(y,{}),e.jsxs("div",{className:"main-container",children:[e.jsx(b,{}),e.jsx("div",{className:"content",children:e.jsxs("div",{className:"notification-list",children:[e.jsxs("div",{className:"notification-header",children:[e.jsx("h2",{children:"Notifications"}),c.length>0&&e.jsx("button",{onClick:k,className:"mark-all-read-btn",children:"Mark All as Read"})]}),c.length===0?e.jsx("p",{children:"No notifications"}):c.map((t,s)=>{const a=s===c.length-1;return e.jsxs("div",{className:`notification-item ${t.status==="Unread"?"unread":"read"}`,ref:a?j:null,onClick:()=>{t.status==="Unread"&&w(t.notification_id)},children:[e.jsx("img",{src:`${t.image}`,alt:"Notification",className:"notification-image"}),e.jsxs("div",{className:"notification-content",children:[e.jsx("span",{className:"time",children:$(t.sent_at)}),t.link?e.jsx(v,{to:t.link,children:e.jsx("p",{children:t.texts})}):e.jsx("p",{children:t.texts})]}),t.status==="Unread"&&e.jsx("div",{className:"unread-indicator"})]},t.notification_id)})]})})]}),e.jsx(_,{})]})};export{R as default};
