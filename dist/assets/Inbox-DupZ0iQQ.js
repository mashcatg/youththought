import{r as n,a as P,j as s}from"./index-BAH94AsE.js";import{G as k,T as R,S as z,B}from"./BottomNavbar-CoKUF_2U.js";import"./logo-lBSZb2lU.js";function O(r){return k({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M217.9 256L345 129c9.4-9.4 9.4-24.6 0-33.9-9.4-9.4-24.6-9.3-34 0L167 239c-9.1 9.1-9.3 23.7-.7 33.1L310.9 417c4.7 4.7 10.9 7 17 7s12.3-2.3 17-7c9.4-9.4 9.4-24.6 0-33.9L217.9 256z"},child:[]}]})(r)}function V(r){return k({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{id:"Image_On"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{d:"M18.435,3.06H5.565a2.5,2.5,0,0,0-2.5,2.5V18.44a2.507,2.507,0,0,0,2.5,2.5h12.87a2.507,2.507,0,0,0,2.5-2.5V5.56A2.5,2.5,0,0,0,18.435,3.06ZM4.065,5.56a1.5,1.5,0,0,1,1.5-1.5h12.87a1.5,1.5,0,0,1,1.5,1.5v8.66l-3.88-3.88a1.509,1.509,0,0,0-2.12,0l-4.56,4.57a.513.513,0,0,1-.71,0l-.56-.56a1.522,1.522,0,0,0-2.12,0l-1.92,1.92Zm15.87,12.88a1.5,1.5,0,0,1-1.5,1.5H5.565a1.5,1.5,0,0,1-1.5-1.5v-.75L6.7,15.06a.5.5,0,0,1,.35-.14.524.524,0,0,1,.36.14l.55.56a1.509,1.509,0,0,0,2.12,0l4.57-4.57a.5.5,0,0,1,.71,0l4.58,4.58Z"},child:[]},{tag:"path",attr:{d:"M8.062,10.565a2.5,2.5,0,1,1,2.5-2.5A2.5,2.5,0,0,1,8.062,10.565Zm0-4a1.5,1.5,0,1,0,1.5,1.5A1.5,1.5,0,0,0,8.062,6.565Z"},child:[]}]}]}]})(r)}const W=()=>{var I;const[r,g]=n.useState(null),[f,M]=n.useState(window.innerWidth<=767),[p,E]=n.useState([]),[Z,d]=n.useState(!0),[H,l]=n.useState(null),[h,w]=n.useState([]),[c,x]=n.useState(""),[m,j]=n.useState(null),v=n.useRef(null),C=n.useRef(null),[N,i]=n.useState(!0),[_,T]=n.useState(null),{userId1:u}=P();n.useEffect(()=>{u&&S(u)},[u]),n.useEffect(()=>{(async()=>{try{const a=await fetch("https://www.youthsthought.com/backend/check_auth.php",{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch user ID");const t=await a.json();t.user_id?T(t.user_id):t.error&&l(t.error)}catch{l("Error fetching user ID")}})()},[]);const y=e=>{if(!e)return"Just now";const a=new Date(e);if(isNaN(a.getTime()))return"N/A";const o=Math.floor((new Date-a)/1e3);return o<60?"Just now":o<3600?`${Math.floor(o/60)} min ago`:o<86400?`${Math.floor(o/3600)} hour(s) ago`:`${Math.floor(o/86400)} day(s) ago`};n.useEffect(()=>{var e;N&&((e=v.current)==null||e.scrollIntoView({behavior:"smooth"}))},[h,N]),n.useEffect(()=>{const e=async()=>{try{const t=await fetch("https://www.youthsthought.com/backend/conversation.php",{credentials:"include"});if(!t.ok){const D=await t.text();throw new Error(`Network response was not ok: ${D}`)}const o=await t.json();E(o)}catch(t){console.error("Error fetching conversations:",t.message),l(t.message)}finally{d(!1)}};e();const a=setInterval(()=>{e(),r&&b(r)},5e3);return()=>clearInterval(a)},[r]);const b=async e=>{try{d(!0);const a=await fetch(`https://www.youthsthought.com/backend/messages.php?otherUserId=${e}`,{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch messages");const t=await a.json();if(t.error)throw new Error(t.error);w(t),i(!0)}catch(a){console.error("Error fetching messages:",a),l("Failed to fetch messages")}finally{d(!1)}},$=async e=>{try{(await(await fetch("https://www.youthsthought.com/backend/mark_messages_seen.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`conversation_id=${e}`,credentials:"include"})).json()).success||console.log("Failed to mark messages as seen")}catch(a){console.error("Error:",a)}},A=e=>{if(c.trim()===""&&!m)return;const a=new FormData;a.append("conversation_id",e),c.trim()!==""&&a.append("message",c),m&&a.append("image",m),fetch("https://www.youthsthought.com/backend/insert_message.php",{method:"POST",body:a,credentials:"include"}).then(t=>t.json()).then(t=>{t.success?(w(o=>[...o,{id:t.messageId,text:c,msg_time:new Date().toISOString(),sender:"me",media:t.imagePath||null}]),x(""),j(null),i(!0)):console.error("Failed to send message:",t.message)}).catch(t=>console.error("Error:",t))},S=e=>{g(e),b(e),$(e),i(!0)};n.useEffect(()=>{const e=()=>{M(window.innerWidth<=767)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const F=e=>{j(e.target.files[0])},L=e=>{const a=e.target,t=a.scrollHeight===a.scrollTop+a.clientHeight;i(!!t)};return s.jsxs("div",{className:"inbox-page",children:[s.jsx(R,{}),s.jsxs("div",{className:"main-container",children:[s.jsx(z,{}),s.jsxs("div",{className:`content ${f?"mobile-view":""}`,children:[s.jsx("div",{className:"conversations-list",children:p.map(e=>s.jsxs("div",{className:`conversation-item ${r===e.id?"active":""}`,onClick:()=>S(e.id),children:[s.jsx("img",{src:e.profilePic,alt:"Profile",className:"conversation-profile-pic"}),s.jsxs("div",{className:"conversation-info",children:[s.jsx("span",{className:"conversation-name",children:e.name}),s.jsx("b",{children:_===e.id&&e.seen===0?"- unread":""}),s.jsx("br",{}),s.jsx("span",{className:"conversation-last-message",children:e.lastMessage!==null?s.jsx("span",{className:"message-text",children:e.lastMessage}):s.jsxs("span",{className:"image-placeholder",style:{display:"flex"},children:[s.jsx(V,{style:{marginRight:"3px"}})," Image"]})}),s.jsxs("span",{className:"conversation-date",children:["- ",y(e.date)]})]})]},e.id))}),s.jsx("div",{className:"chat-window",children:r?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"chat-header",children:[f&&s.jsx("button",{className:"back-button",onClick:()=>g(null),children:s.jsx(O,{size:24})}),s.jsxs("h2",{children:["Chat with"," ",(I=p.find(e=>e.id===r))==null?void 0:I.name]})]}),s.jsxs("div",{className:"chat-messages",ref:C,onScroll:L,children:[h.length===0?s.jsx("p",{children:"No messages"}):h.map(e=>s.jsxs("div",{className:`chat-message ${e.sender==="me"?"sent":"received"}`,children:[e.media&&s.jsx("img",{src:`https://www.youthsthought.com/backend/${e.media}`,alt:"Message Media",className:"message-image"}),e.text!==null&&e.text!==void 0?s.jsx("span",{className:"message-text",children:e.text}):null,s.jsx("span",{className:"message-timestamp",children:y(e.timestamp)})," "]},e.id)),s.jsx("div",{ref:v})]}),s.jsxs("div",{className:"chat-input",children:[s.jsxs("div",{className:"form__group",children:[s.jsx("input",{type:"text",className:"form__field",placeholder:"Type a message...",name:"message",id:"message",required:!0,value:c,onChange:e=>x(e.target.value)}),s.jsx("label",{htmlFor:"message",className:"form__label",children:"Type a message..."})]}),s.jsx("input",{type:"file",onChange:F,accept:"image/*"}),s.jsx("button",{onClick:()=>A(r),children:"Send"})]})]}):s.jsx("div",{className:"select-conversation-message",children:s.jsx("p",{children:"Select a conversation to start chatting"})})})]})]}),s.jsx(B,{})]})};export{W as default};
